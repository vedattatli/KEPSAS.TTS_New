@model KEPSAS.TTS.Models.Talep
@using KEPSAS.TTS.Data
@{
    ViewData["Title"] = $"Talep Detayı: #{Model.Id}";
    bool isAdmin = User.IsInRole("Admin");
}

<div class="row">
    <div class="col-lg-8">
        <div class="content-card">
            <div class="content-card-header">Talep Bilgileri</div>
            <div class="p-3">
                <div class="mb-2"><strong>Başlık:</strong> @Model.Baslik</div>
                <div class="mb-2"><strong>Durum:</strong> @Model.Durum</div>
                <div class="mb-2"><strong>Oluşturan:</strong> @(Model.OlusturanKullaniciId ?? "-")</div>
                <div class="mb-2"><strong>Oluşturan:</strong> @(Model.OlusturanKullaniciId ?? "-")</div>
                <hr />
                <div>@(Model.Aciklama ?? "-")</div>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <div class="content-card">
            <div class="content-card-header">İşlemler</div>
            <div class="p-3">
                @if (isAdmin)
                {
                    <!-- Atama -->
                    <form asp-action="Assign" method="post" class="mb-3">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="id" value="@Model.Id" />
                        <label>Atanacak Kullanıcı</label>
                        <select name="userId" class="form-control">
                            <option value="">(Atama kaldır)</option>
                            @foreach (var u in ViewBag.AssignableUsers as IEnumerable<SelectListItem> ?? Enumerable.Empty<SelectListItem>())
                            {
                                <option value="@u.Value" selected="@(Model.AtananKullaniciId == u.Value)">
                                    @u.Text
                                </option>
                            }
                        </select>
                        <button class="btn btn-sm btn-outline-primary mt-2">Kaydet</button>
                    </form>

                    <!-- Hızlı Durum -->
                    <form asp-action="SetStatus" method="post" class="d-flex flex-wrap gap-2">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="id" value="@Model.Id" />
                        <button name="durum" value="Üzerimde" class="btn btn-sm btn-info mr-2">Üzerimde</button>
                        <button name="durum" value="Bekliyor" class="btn btn-sm btn-warning mr-2">Bekliyor</button>
                        <button name="durum" value="Tamamlandı" class="btn btn-sm btn-success">Tamamlandı</button>
                    </form>
                }
                else
                {
                    <div class="text-muted">Bu talep üzerinde işlem yetkiniz yok.</div>
                }
            </div>
        </div>
    </div>
</div>
